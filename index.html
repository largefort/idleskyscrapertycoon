<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Idle Skyscraper Tycoon</title>

<meta name="viewport"
      content="width=device-width, initial-scale=1.0,
               maximum-scale=1.0, user-scalable=no">

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/material-components-web@14.0.0/dist/material-components-web.min.css">

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: #eceff1;
  font-family: Roboto, Arial, sans-serif;
  touch-action: manipulation;
}

/* HEADER */
header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 56px;
  background: #6200ee;
  color: white;
  display: flex;
  align-items: center;
  padding: 0 16px;
  font-size: 18px;
  z-index: 10;
}

/* CANVAS FULLSCREEN */
#gameCanvas {
  position: absolute;
  top: 56px;
  left: 0;
  width: 100vw;
  height: calc(100vh - 56px);
  background: linear-gradient(#cfd8dc, #eceff1);
  touch-action: manipulation;
}

/* HUD */
#hud {
  position: fixed;
  top: 72px;
  left: 16px;
  background: rgba(255,255,255,0.9);
  border-radius: 8px;
  padding: 12px 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  z-index: 10;
}

.stat {
  font-size: 14px;
  margin: 4px 0;
}

/* BUILD BUTTON */
#buildBtn {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
}

button[disabled] {
  opacity: 0.6;
}
</style>
</head>

<body>

<header>üèôÔ∏è Idle Skyscraper Tycoon</header>

<div id="hud">
  <div class="stat">Money: <strong id="money">$0</strong></div>
  <div class="stat">Floors: <strong id="floors">0</strong></div>
  <div class="stat">Income/sec: <strong id="income">$0</strong></div>
</div>

<canvas id="gameCanvas"></canvas>

<button id="buildBtn"
        class="mdc-button mdc-button--raised"
        onclick="buildFloor()">
  <span class="mdc-button__label" id="buildLabel">
    Build Floor ($0)
  </span>
</button>

<script>
/* =========================
   DISABLE PINCH ZOOM (iOS / Safari)
========================= */
document.addEventListener('gesturestart', e => e.preventDefault());
document.addEventListener('gesturechange', e => e.preventDefault());
document.addEventListener('gestureend', e => e.preventDefault());

/* =========================
   SAVE VERSIONING
========================= */
const SAVE_VERSION = 1;

/* =========================
   CONSTANTS
========================= */
const TENANTS = {
  office:  { income: 2, color: "#90caf9" },
  shop:    { income: 4, color: "#a5d6a7" },
  luxury:  { income: 8, color: "#ffcc80" }
};

const BASE_FLOOR_COST = 60;
const BUILD_TIME = 800;
const FLOOR_HEIGHT = 28;
const FLOOR_MARGIN = 3;
const GROUND_PADDING = 120;

/* =========================
   GAME STATE
========================= */
let game = {
  version: SAVE_VERSION,
  money: 60,
  floors: [],
  lastTick: Date.now()
};

/* =========================
   SAVE / LOAD
========================= */
function saveGame() {
  localStorage.setItem("skyscraperTycoon", JSON.stringify(game));
}

function loadGame() {
  const saved = localStorage.getItem("skyscraperTycoon");
  if (!saved) return;

  const data = JSON.parse(saved);
  game.money = Math.max(data.money ?? 60, 60);
  game.floors = data.floors || [];
  game.lastTick = data.lastTick || Date.now();
}

/* =========================
   LOGIC
========================= */
function randomTenant() {
  const keys = Object.keys(TENANTS);
  return keys[Math.floor(Math.random() * keys.length)];
}

function floorCost() {
  return Math.floor(BASE_FLOOR_COST * Math.pow(1.18, game.floors.length));
}

function isBuilt(floor) {
  return Date.now() >= floor.builtAt;
}

function incomePerSecond() {
  return game.floors
    .filter(isBuilt)
    .reduce((sum, f) => sum + TENANTS[f.tenant].income, 0);
}

function buildFloor() {
  const cost = floorCost();
  if (game.money < cost) return;

  game.money -= cost;
  game.floors.push({
    tenant: randomTenant(),
    builtAt: Date.now() + BUILD_TIME
  });

  saveGame();
}

/* =========================
   OFFLINE PROGRESS
========================= */
function applyOfflineIncome() {
  const now = Date.now();
  const elapsed = Math.floor((now - game.lastTick) / 1000);
  if (elapsed > 0) {
    game.money += incomePerSecond() * elapsed;
  }
  game.lastTick = now;
}

/* =========================
   CANVAS + CAMERA
========================= */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let cameraY = 0;
let targetCameraY = 0;

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight - 56;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

/* =========================
   RENDER
========================= */
function drawSkyscraper() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const width = 160;
  const baseX = (canvas.width - width) / 2;

  const visibleHeight = canvas.height - GROUND_PADDING;
  const towerHeight = game.floors.length * FLOOR_HEIGHT;

  targetCameraY = towerHeight <= visibleHeight
    ? 0
    : towerHeight - visibleHeight;

  cameraY += (targetCameraY - cameraY) * 0.08;

  let y = canvas.height - FLOOR_MARGIN + cameraY;

  game.floors.forEach(floor => {
    y -= FLOOR_HEIGHT;

    const built = isBuilt(floor);
    const progress = built
      ? 1
      : Math.max(0, 1 - (floor.builtAt - Date.now()) / BUILD_TIME);

    const offset = FLOOR_HEIGHT * (1 - progress);

    ctx.fillStyle = built
      ? TENANTS[floor.tenant].color
      : "#b0bec5";

    ctx.fillRect(baseX, y + offset, width, FLOOR_HEIGHT - FLOOR_MARGIN);
  });
}

/* =========================
   UI & LOOPS
========================= */
function updateUI() {
  document.getElementById("money").textContent = "$" + Math.floor(game.money);
  document.getElementById("floors").textContent = game.floors.length;
  document.getElementById("income").textContent = "$" + incomePerSecond();

  const cost = floorCost();
  document.getElementById("buildLabel").textContent = `Build Floor ($${cost})`;
  document.getElementById("buildBtn").disabled = game.money < cost;
}

function tick() {
  applyOfflineIncome();
  saveGame();
  updateUI();
}

function renderLoop() {
  drawSkyscraper();
  requestAnimationFrame(renderLoop);
}

loadGame();
applyOfflineIncome();
updateUI();
setInterval(tick, 1000);
requestAnimationFrame(renderLoop);
</script>

</body>
</html>
