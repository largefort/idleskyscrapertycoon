<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Idle Skyscraper Tycoon</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/material-components-web@14.0.0/dist/material-components-web.min.css">

<style>
body {
  margin: 0;
  background: #eceff1;
  font-family: Roboto, Arial, sans-serif;
}

header {
  background: #6200ee;
  color: white;
  padding: 16px;
  font-size: 20px;
  text-align: center;
}

.container {
  max-width: 520px;
  margin: auto;
  padding: 16px;
}

.card {
  margin-bottom: 16px;
}

.stat {
  font-size: 16px;
  margin: 6px 0;
}

canvas {
  display: block;
  margin: auto;
  background: linear-gradient(#cfd8dc, #eceff1);
  border-radius: 8px;
}

.actions button {
  width: 100%;
  margin-top: 8px;
}

button[disabled] {
  opacity: 0.6;
}

footer {
  text-align: center;
  font-size: 12px;
  color: #666;
  margin: 24px 0;
}
</style>
</head>

<body>

<header>üèôÔ∏è Idle Skyscraper Tycoon</header>

<div class="container">

<div class="mdc-card card">
  <div style="padding:16px">
    <div class="stat">Money: <strong id="money">$0</strong></div>
    <div class="stat">Floors: <strong id="floors">0</strong></div>
    <div class="stat">Income/sec: <strong id="income">$0</strong></div>
  </div>
</div>

<div class="mdc-card card">
  <div style="padding:16px">
    <canvas id="skyscraper" width="220" height="380"></canvas>
  </div>
</div>

<div class="mdc-card card">
  <div style="padding:16px" class="actions">
    <button id="buildBtn"
            class="mdc-button mdc-button--raised"
            onclick="buildFloor()">
      <span class="mdc-button__label" id="buildLabel">
        Build Floor ($0)
      </span>
    </button>
  </div>
</div>

</div>

<footer>
Canvas Idle Game ‚Äì Fully Debugged
</footer>

<script>
/* =========================
   CONSTANTS
========================= */
const TENANTS = {
  office:  { income: 2, color: "#90caf9" },
  shop:    { income: 4, color: "#a5d6a7" },
  luxury:  { income: 8, color: "#ffcc80" }
};

const BASE_FLOOR_COST = 60;
const BUILD_TIME = 800;
const FLOOR_HEIGHT = 24;
const FLOOR_MARGIN = 2;

/* =========================
   GAME STATE
========================= */
let game = {
  money: 100,          // ‚úÖ bootstrap
  floors: [],
  lastTick: Date.now()
};

/* =========================
   SAVE / LOAD
========================= */
function saveGame() {
  localStorage.setItem("skyscraperTycoon", JSON.stringify(game));
}

function loadGame() {
  const saved = localStorage.getItem("skyscraperTycoon");
  if (!saved) return;

  const data = JSON.parse(saved);

  game.money = data.money ?? 100;
  game.floors = data.floors ?? [];
  game.lastTick = data.lastTick ?? Date.now();
}

/* =========================
   LOGIC
========================= */
function randomTenant() {
  return Object.keys(TENANTS)[
    Math.floor(Math.random() * 3)
  ];
}

function floorCost() {
  return Math.floor(
    BASE_FLOOR_COST * Math.pow(1.18, game.floors.length)
  );
}

function isBuilt(floor) {
  return Date.now() >= floor.builtAt;
}

function incomePerSecond() {
  return game.floors
    .filter(isBuilt)
    .reduce((sum, f) => sum + TENANTS[f.tenant].income, 0);
}

function buildFloor() {
  const cost = floorCost();
  if (game.money < cost) return;

  game.money -= cost;
  game.floors.push({
    tenant: randomTenant(),
    builtAt: Date.now() + BUILD_TIME
  });

  saveGame();
}

/* =========================
   OFFLINE PROGRESS
========================= */
function applyOfflineIncome() {
  const now = Date.now();
  const elapsed = Math.floor((now - game.lastTick) / 1000);
  if (elapsed > 0) {
    game.money += incomePerSecond() * elapsed;
  }
  game.lastTick = now;
}

/* =========================
   CANVAS
========================= */
const canvas = document.getElementById("skyscraper");
const ctx = canvas.getContext("2d");

function drawSkyscraper() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const baseX = 50;
  const width = 120;
  let y = canvas.height - FLOOR_MARGIN;

  game.floors.forEach(floor => {
    y -= FLOOR_HEIGHT;

    const built = isBuilt(floor);
    const progress = built
      ? 1
      : Math.max(
          0,
          1 - (floor.builtAt - Date.now()) / BUILD_TIME
        );

    const offset = FLOOR_HEIGHT * (1 - progress);

    ctx.fillStyle = built
      ? TENANTS[floor.tenant].color
      : "#b0bec5";

    ctx.fillRect(
      baseX,
      y + offset,
      width,
      FLOOR_HEIGHT - FLOOR_MARGIN
    );
  });

  ctx.fillStyle = "#546e7a";
  ctx.fillRect(40, canvas.height - 6, 140, 6);
}

/* =========================
   UI
========================= */
function updateUI() {
  document.getElementById("money").textContent =
    "$" + Math.floor(game.money);

  document.getElementById("floors").textContent =
    game.floors.length;

  document.getElementById("income").textContent =
    "$" + incomePerSecond();

  const cost = floorCost();
  const btn = document.getElementById("buildBtn");
  const label = document.getElementById("buildLabel");

  label.textContent = `Build Floor ($${cost})`;
  btn.disabled = game.money < cost;
}

/* =========================
   LOOPS
========================= */
function tick() {
  applyOfflineIncome();
  saveGame();
  updateUI();
}

function renderLoop() {
  drawSkyscraper();
  requestAnimationFrame(renderLoop);
}

/* =========================
   INIT
========================= */
loadGame();
applyOfflineIncome();
updateUI();
setInterval(tick, 1000);
requestAnimationFrame(renderLoop);
</script>

</body>
</html>
